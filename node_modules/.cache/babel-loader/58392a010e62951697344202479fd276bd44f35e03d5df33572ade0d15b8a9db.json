{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { isArray } from 'vega-util';\nimport { COLUMN, FACET, ROW } from '../channel';\nimport { hasConditionalFieldOrDatumDef, isFieldOrDatumDef, isValueDef } from '../channeldef';\nimport { boxPlotNormalizer } from '../compositemark/boxplot';\nimport { errorBandNormalizer } from '../compositemark/errorband';\nimport { errorBarNormalizer } from '../compositemark/errorbar';\nimport { channelHasField } from '../encoding';\nimport * as log from '../log';\nimport { isFacetMapping } from '../spec/facet';\nimport { SpecMapper } from '../spec/map';\nimport { isLayerRepeatSpec } from '../spec/repeat';\nimport { isUnitSpec } from '../spec/unit';\nimport { isEmpty, keys, omit, varName } from '../util';\nimport { isSignalRef } from '../vega.schema';\nimport { PathOverlayNormalizer } from './pathoverlay';\nimport { replaceRepeaterInEncoding, replaceRepeaterInFacet } from './repeater';\nimport { RuleForRangedLineNormalizer } from './ruleforrangedline';\nexport class CoreNormalizer extends SpecMapper {\n  constructor() {\n    super(...arguments);\n    this.nonFacetUnitNormalizers = [boxPlotNormalizer, errorBarNormalizer, errorBandNormalizer, new PathOverlayNormalizer(), new RuleForRangedLineNormalizer()];\n  }\n  map(spec, params) {\n    // Special handling for a faceted unit spec as it can return a facet spec, not just a layer or unit spec like a normal unit spec.\n    if (isUnitSpec(spec)) {\n      const hasRow = channelHasField(spec.encoding, ROW);\n      const hasColumn = channelHasField(spec.encoding, COLUMN);\n      const hasFacet = channelHasField(spec.encoding, FACET);\n      if (hasRow || hasColumn || hasFacet) {\n        return this.mapFacetedUnit(spec, params);\n      }\n    }\n    return super.map(spec, params);\n  }\n  // This is for normalizing non-facet unit\n  mapUnit(spec, params) {\n    const {\n      parentEncoding,\n      parentProjection\n    } = params;\n    const encoding = replaceRepeaterInEncoding(spec.encoding, params.repeater);\n    const specWithReplacedEncoding = {\n      ...spec,\n      ...(spec.name ? {\n        name: [params.repeaterPrefix, spec.name].filter(n => n).join('_')\n      } : {}),\n      ...(encoding ? {\n        encoding\n      } : {})\n    };\n    if (parentEncoding || parentProjection) {\n      return this.mapUnitWithParentEncodingOrProjection(specWithReplacedEncoding, params);\n    }\n    const normalizeLayerOrUnit = this.mapLayerOrUnit.bind(this);\n    for (const unitNormalizer of this.nonFacetUnitNormalizers) {\n      if (unitNormalizer.hasMatchingType(specWithReplacedEncoding, params.config)) {\n        return unitNormalizer.run(specWithReplacedEncoding, params, normalizeLayerOrUnit);\n      }\n    }\n    return specWithReplacedEncoding;\n  }\n  mapRepeat(spec, params) {\n    if (isLayerRepeatSpec(spec)) {\n      return this.mapLayerRepeat(spec, params);\n    } else {\n      return this.mapNonLayerRepeat(spec, params);\n    }\n  }\n  mapLayerRepeat(spec, params) {\n    const {\n      repeat,\n      spec: childSpec,\n      ...rest\n    } = spec;\n    const {\n      row,\n      column,\n      layer\n    } = repeat;\n    const {\n      repeater = {},\n      repeaterPrefix = ''\n    } = params;\n    if (row || column) {\n      return this.mapRepeat({\n        ...spec,\n        repeat: {\n          ...(row ? {\n            row\n          } : {}),\n          ...(column ? {\n            column\n          } : {})\n        },\n        spec: {\n          repeat: {\n            layer\n          },\n          spec: childSpec\n        }\n      }, params);\n    } else {\n      return {\n        ...rest,\n        layer: layer.map(layerValue => {\n          const childRepeater = {\n            ...repeater,\n            layer: layerValue\n          };\n          const childName = `${(childSpec.name ? `${childSpec.name}_` : '') + repeaterPrefix}child__layer_${varName(layerValue)}`;\n          const child = this.mapLayerOrUnit(childSpec, {\n            ...params,\n            repeater: childRepeater,\n            repeaterPrefix: childName\n          });\n          child.name = childName;\n          return child;\n        })\n      };\n    }\n  }\n  mapNonLayerRepeat(spec, params) {\n    const {\n      repeat,\n      spec: childSpec,\n      data,\n      ...remainingProperties\n    } = spec;\n    if (!isArray(repeat) && spec.columns) {\n      // is repeat with row/column\n      spec = omit(spec, ['columns']);\n      log.warn(log.message.columnsNotSupportByRowCol('repeat'));\n    }\n    const concat = [];\n    const {\n      repeater = {},\n      repeaterPrefix = ''\n    } = params;\n    const row = !isArray(repeat) && repeat.row || [repeater ? repeater.row : null];\n    const column = !isArray(repeat) && repeat.column || [repeater ? repeater.column : null];\n    const repeatValues = isArray(repeat) && repeat || [repeater ? repeater.repeat : null];\n    // cross product\n    for (const repeatValue of repeatValues) {\n      for (const rowValue of row) {\n        for (const columnValue of column) {\n          const childRepeater = {\n            repeat: repeatValue,\n            row: rowValue,\n            column: columnValue,\n            layer: repeater.layer\n          };\n          const childName = (childSpec.name ? `${childSpec.name}_` : '') + repeaterPrefix + 'child__' + (isArray(repeat) ? `${varName(repeatValue)}` : (repeat.row ? `row_${varName(rowValue)}` : '') + (repeat.column ? `column_${varName(columnValue)}` : ''));\n          const child = this.map(childSpec, {\n            ...params,\n            repeater: childRepeater,\n            repeaterPrefix: childName\n          });\n          child.name = childName;\n          // we move data up\n          concat.push(omit(child, ['data']));\n        }\n      }\n    }\n    const columns = isArray(repeat) ? spec.columns : repeat.column ? repeat.column.length : 1;\n    return {\n      data: childSpec.data ?? data,\n      align: 'all',\n      ...remainingProperties,\n      columns,\n      concat\n    };\n  }\n  mapFacet(spec, params) {\n    const {\n      facet\n    } = spec;\n    if (isFacetMapping(facet) && spec.columns) {\n      // is facet with row/column\n      spec = omit(spec, ['columns']);\n      log.warn(log.message.columnsNotSupportByRowCol('facet'));\n    }\n    return super.mapFacet(spec, params);\n  }\n  mapUnitWithParentEncodingOrProjection(spec, params) {\n    const {\n      encoding,\n      projection\n    } = spec;\n    const {\n      parentEncoding,\n      parentProjection,\n      config\n    } = params;\n    const mergedProjection = mergeProjection({\n      parentProjection,\n      projection\n    });\n    const mergedEncoding = mergeEncoding({\n      parentEncoding,\n      encoding: replaceRepeaterInEncoding(encoding, params.repeater)\n    });\n    return this.mapUnit({\n      ...spec,\n      ...(mergedProjection ? {\n        projection: mergedProjection\n      } : {}),\n      ...(mergedEncoding ? {\n        encoding: mergedEncoding\n      } : {})\n    }, {\n      config\n    });\n  }\n  mapFacetedUnit(spec, normParams) {\n    // New encoding in the inside spec should not contain row / column\n    // as row/column should be moved to facet\n    const {\n      row,\n      column,\n      facet,\n      ...encoding\n    } = spec.encoding;\n    // Mark and encoding should be moved into the inner spec\n    const {\n      mark,\n      width,\n      projection,\n      height,\n      view,\n      params,\n      encoding: _,\n      ...outerSpec\n    } = spec;\n    const {\n      facetMapping,\n      layout\n    } = this.getFacetMappingAndLayout({\n      row,\n      column,\n      facet\n    }, normParams);\n    const newEncoding = replaceRepeaterInEncoding(encoding, normParams.repeater);\n    return this.mapFacet({\n      ...outerSpec,\n      ...layout,\n      // row / column has higher precedence than facet\n      facet: facetMapping,\n      spec: {\n        ...(width ? {\n          width\n        } : {}),\n        ...(height ? {\n          height\n        } : {}),\n        ...(view ? {\n          view\n        } : {}),\n        ...(projection ? {\n          projection\n        } : {}),\n        mark,\n        encoding: newEncoding,\n        ...(params ? {\n          params\n        } : {})\n      }\n    }, normParams);\n  }\n  getFacetMappingAndLayout(facets, params) {\n    const {\n      row,\n      column,\n      facet\n    } = facets;\n    if (row || column) {\n      if (facet) {\n        log.warn(log.message.facetChannelDropped([...(row ? [ROW] : []), ...(column ? [COLUMN] : [])]));\n      }\n      const facetMapping = {};\n      const layout = {};\n      for (const channel of [ROW, COLUMN]) {\n        const def = facets[channel];\n        if (def) {\n          const {\n            align,\n            center,\n            spacing,\n            columns,\n            ...defWithoutLayout\n          } = def;\n          facetMapping[channel] = defWithoutLayout;\n          for (const prop of ['align', 'center', 'spacing']) {\n            if (def[prop] !== undefined) {\n              layout[prop] ?? (layout[prop] = {});\n              layout[prop][channel] = def[prop];\n            }\n          }\n        }\n      }\n      return {\n        facetMapping,\n        layout\n      };\n    } else {\n      const {\n        align,\n        center,\n        spacing,\n        columns,\n        ...facetMapping\n      } = facet;\n      return {\n        facetMapping: replaceRepeaterInFacet(facetMapping, params.repeater),\n        layout: {\n          ...(align ? {\n            align\n          } : {}),\n          ...(center ? {\n            center\n          } : {}),\n          ...(spacing ? {\n            spacing\n          } : {}),\n          ...(columns ? {\n            columns\n          } : {})\n        }\n      };\n    }\n  }\n  mapLayer(spec, {\n    parentEncoding,\n    parentProjection,\n    ...otherParams\n  }) {\n    // Special handling for extended layer spec\n    const {\n      encoding,\n      projection,\n      ...rest\n    } = spec;\n    const params = {\n      ...otherParams,\n      parentEncoding: mergeEncoding({\n        parentEncoding,\n        encoding,\n        layer: true\n      }),\n      parentProjection: mergeProjection({\n        parentProjection,\n        projection\n      })\n    };\n    return super.mapLayer({\n      ...rest,\n      ...(spec.name ? {\n        name: [params.repeaterPrefix, spec.name].filter(n => n).join('_')\n      } : {})\n    }, params);\n  }\n}\nfunction mergeEncoding({\n  parentEncoding,\n  encoding = {},\n  layer\n}) {\n  let merged = {};\n  if (parentEncoding) {\n    const channels = new Set([...keys(parentEncoding), ...keys(encoding)]);\n    for (const channel of channels) {\n      const channelDef = encoding[channel];\n      const parentChannelDef = parentEncoding[channel];\n      if (isFieldOrDatumDef(channelDef)) {\n        // Field/Datum Def can inherit properties from its parent\n        // Note that parentChannelDef doesn't have to be a field/datum def if the channelDef is already one.\n        const mergedChannelDef = {\n          ...parentChannelDef,\n          ...channelDef\n        };\n        merged[channel] = mergedChannelDef;\n      } else if (hasConditionalFieldOrDatumDef(channelDef)) {\n        merged[channel] = {\n          ...channelDef,\n          condition: {\n            ...parentChannelDef,\n            ...channelDef.condition\n          }\n        };\n      } else if (channelDef || channelDef === null) {\n        merged[channel] = channelDef;\n      } else if (layer || isValueDef(parentChannelDef) || isSignalRef(parentChannelDef) || isFieldOrDatumDef(parentChannelDef) || isArray(parentChannelDef)) {\n        merged[channel] = parentChannelDef;\n      }\n    }\n  } else {\n    merged = encoding;\n  }\n  return !merged || isEmpty(merged) ? undefined : merged;\n}\nfunction mergeProjection(opt) {\n  const {\n    parentProjection,\n    projection\n  } = opt;\n  if (parentProjection && projection) {\n    log.warn(log.message.projectionOverridden({\n      parentProjection,\n      projection\n    }));\n  }\n  return projection ?? parentProjection;\n}","map":{"version":3,"mappings":"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","names":["isArray","COLUMN","FACET","ROW","hasConditionalFieldOrDatumDef","isFieldOrDatumDef","isValueDef","boxPlotNormalizer","errorBandNormalizer","errorBarNormalizer","channelHasField","log","isFacetMapping","SpecMapper","isLayerRepeatSpec","isUnitSpec","isEmpty","keys","omit","varName","isSignalRef","PathOverlayNormalizer","replaceRepeaterInEncoding","replaceRepeaterInFacet","RuleForRangedLineNormalizer","CoreNormalizer","constructor","map","spec","params","hasRow","encoding","hasColumn","hasFacet","mapFacetedUnit","mapUnit","parentEncoding","parentProjection","repeater","specWithReplacedEncoding","name","repeaterPrefix","filter","n","join","mapUnitWithParentEncodingOrProjection","normalizeLayerOrUnit","mapLayerOrUnit","bind","unitNormalizer","nonFacetUnitNormalizers","hasMatchingType","config","run","mapRepeat","mapLayerRepeat","mapNonLayerRepeat","repeat","childSpec","rest","row","column","layer","layerValue","childRepeater","childName","child","data","remainingProperties","columns","warn","message","columnsNotSupportByRowCol","concat","repeatValues","repeatValue","rowValue","columnValue","push","length","align","mapFacet","facet","projection","mergedProjection","mergeProjection","mergedEncoding","mergeEncoding","normParams","mark","width","height","view","_","outerSpec","facetMapping","layout","getFacetMappingAndLayout","newEncoding","facets","facetChannelDropped","channel","def","center","spacing","defWithoutLayout","prop","undefined","mapLayer","otherParams","merged","channels","Set","channelDef","parentChannelDef","mergedChannelDef","condition","opt","projectionOverridden"],"sourceRoot":"","sources":["../../../src/normalize/core.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}