{"ast":null,"code":"import { isObject, isString } from 'vega-util';\nimport { dateTimeExprToExpr } from './datetime';\nimport { accessPathWithDatum, keys, stringify, varName } from './util';\n/** Time Unit that only corresponds to only one part of Date objects. */\nexport const LOCAL_SINGLE_TIMEUNIT_INDEX = {\n  year: 1,\n  quarter: 1,\n  month: 1,\n  week: 1,\n  day: 1,\n  dayofyear: 1,\n  date: 1,\n  hours: 1,\n  minutes: 1,\n  seconds: 1,\n  milliseconds: 1\n};\nexport const TIMEUNIT_PARTS = keys(LOCAL_SINGLE_TIMEUNIT_INDEX);\nexport function isLocalSingleTimeUnit(timeUnit) {\n  return !!LOCAL_SINGLE_TIMEUNIT_INDEX[timeUnit];\n}\nexport const UTC_SINGLE_TIMEUNIT_INDEX = {\n  utcyear: 1,\n  utcquarter: 1,\n  utcmonth: 1,\n  utcweek: 1,\n  utcday: 1,\n  utcdayofyear: 1,\n  utcdate: 1,\n  utchours: 1,\n  utcminutes: 1,\n  utcseconds: 1,\n  utcmilliseconds: 1\n};\nexport const LOCAL_MULTI_TIMEUNIT_INDEX = {\n  yearquarter: 1,\n  yearquartermonth: 1,\n  yearmonth: 1,\n  yearmonthdate: 1,\n  yearmonthdatehours: 1,\n  yearmonthdatehoursminutes: 1,\n  yearmonthdatehoursminutesseconds: 1,\n  yearweek: 1,\n  yearweekday: 1,\n  yearweekdayhours: 1,\n  yearweekdayhoursminutes: 1,\n  yearweekdayhoursminutesseconds: 1,\n  yeardayofyear: 1,\n  quartermonth: 1,\n  monthdate: 1,\n  monthdatehours: 1,\n  monthdatehoursminutes: 1,\n  monthdatehoursminutesseconds: 1,\n  weekday: 1,\n  weeksdayhours: 1,\n  weekdayhoursminutes: 1,\n  weekdayhoursminutesseconds: 1,\n  dayhours: 1,\n  dayhoursminutes: 1,\n  dayhoursminutesseconds: 1,\n  hoursminutes: 1,\n  hoursminutesseconds: 1,\n  minutesseconds: 1,\n  secondsmilliseconds: 1\n};\nexport const UTC_MULTI_TIMEUNIT_INDEX = {\n  utcyearquarter: 1,\n  utcyearquartermonth: 1,\n  utcyearmonth: 1,\n  utcyearmonthdate: 1,\n  utcyearmonthdatehours: 1,\n  utcyearmonthdatehoursminutes: 1,\n  utcyearmonthdatehoursminutesseconds: 1,\n  utcyearweek: 1,\n  utcyearweekday: 1,\n  utcyearweekdayhours: 1,\n  utcyearweekdayhoursminutes: 1,\n  utcyearweekdayhoursminutesseconds: 1,\n  utcyeardayofyear: 1,\n  utcquartermonth: 1,\n  utcmonthdate: 1,\n  utcmonthdatehours: 1,\n  utcmonthdatehoursminutes: 1,\n  utcmonthdatehoursminutesseconds: 1,\n  utcweekday: 1,\n  utcweeksdayhours: 1,\n  utcweekdayhoursminutes: 1,\n  utcweekdayhoursminutesseconds: 1,\n  utcdayhours: 1,\n  utcdayhoursminutes: 1,\n  utcdayhoursminutesseconds: 1,\n  utchoursminutes: 1,\n  utchoursminutesseconds: 1,\n  utcminutesseconds: 1,\n  utcsecondsmilliseconds: 1\n};\nexport function isUTCTimeUnit(t) {\n  return t.startsWith('utc');\n}\nexport function getLocalTimeUnit(t) {\n  return t.substr(3);\n}\n// In order of increasing specificity\nexport const VEGALITE_TIMEFORMAT = {\n  'year-month': '%b %Y ',\n  'year-month-date': '%b %d, %Y '\n};\nexport function getTimeUnitParts(timeUnit) {\n  return TIMEUNIT_PARTS.filter(part => containsTimeUnit(timeUnit, part));\n}\nexport function getSmallestTimeUnitPart(timeUnit) {\n  const parts = getTimeUnitParts(timeUnit);\n  return parts[parts.length - 1];\n}\n/** Returns true if fullTimeUnit contains the timeUnit, false otherwise. */\nexport function containsTimeUnit(fullTimeUnit, timeUnit) {\n  const index = fullTimeUnit.indexOf(timeUnit);\n  if (index < 0) {\n    return false;\n  }\n  // exclude milliseconds\n  if (index > 0 && timeUnit === 'seconds' && fullTimeUnit.charAt(index - 1) === 'i') {\n    return false;\n  }\n  // exclude dayofyear\n  if (fullTimeUnit.length > index + 3 && timeUnit === 'day' && fullTimeUnit.charAt(index + 3) === 'o') {\n    return false;\n  }\n  if (index > 0 && timeUnit === 'year' && fullTimeUnit.charAt(index - 1) === 'f') {\n    return false;\n  }\n  return true;\n}\n/**\r\n * Returns Vega expression for a given timeUnit and fieldRef\r\n */\nexport function fieldExpr(fullTimeUnit, field, {\n  end\n} = {\n  end: false\n}) {\n  const fieldRef = accessPathWithDatum(field);\n  const utc = isUTCTimeUnit(fullTimeUnit) ? 'utc' : '';\n  function func(timeUnit) {\n    if (timeUnit === 'quarter') {\n      // quarter starting at 0 (0,3,6,9).\n      return `(${utc}quarter(${fieldRef})-1)`;\n    } else {\n      return `${utc}${timeUnit}(${fieldRef})`;\n    }\n  }\n  let lastTimeUnit;\n  const dateExpr = {};\n  for (const part of TIMEUNIT_PARTS) {\n    if (containsTimeUnit(fullTimeUnit, part)) {\n      dateExpr[part] = func(part);\n      lastTimeUnit = part;\n    }\n  }\n  if (end) {\n    dateExpr[lastTimeUnit] += '+1';\n  }\n  return dateTimeExprToExpr(dateExpr);\n}\nexport function timeUnitSpecifierExpression(timeUnit) {\n  if (!timeUnit) {\n    return undefined;\n  }\n  const timeUnitParts = getTimeUnitParts(timeUnit);\n  return `timeUnitSpecifier(${stringify(timeUnitParts)}, ${stringify(VEGALITE_TIMEFORMAT)})`;\n}\n/**\r\n * Returns the signal expression used for axis labels for a time unit.\r\n */\nexport function formatExpression(timeUnit, field, isUTCScale) {\n  if (!timeUnit) {\n    return undefined;\n  }\n  const expr = timeUnitSpecifierExpression(timeUnit);\n  // We only use utcFormat for utc scale\n  // For utc time units, the data is already converted as a part of timeUnit transform.\n  // Thus, utc time units should use timeFormat to avoid shifting the time twice.\n  const utc = isUTCScale || isUTCTimeUnit(timeUnit);\n  return `${utc ? 'utc' : 'time'}Format(${field}, ${expr})`;\n}\nexport function normalizeTimeUnit(timeUnit) {\n  if (!timeUnit) {\n    return undefined;\n  }\n  let params;\n  if (isString(timeUnit)) {\n    params = {\n      unit: timeUnit\n    };\n  } else if (isObject(timeUnit)) {\n    params = {\n      ...timeUnit,\n      ...(timeUnit.unit ? {\n        unit: timeUnit.unit\n      } : {})\n    };\n  }\n  if (isUTCTimeUnit(params.unit)) {\n    params.utc = true;\n    params.unit = getLocalTimeUnit(params.unit);\n  }\n  return params;\n}\nexport function timeUnitToString(tu) {\n  const {\n    utc,\n    ...rest\n  } = normalizeTimeUnit(tu);\n  if (rest.unit) {\n    return (utc ? 'utc' : '') + keys(rest).map(p => varName(`${p === 'unit' ? '' : `_${p}_`}${rest[p]}`)).join('');\n  } else {\n    // when maxbins is specified instead of units\n    return (utc ? 'utc' : '') + 'timeunit' + keys(rest).map(p => varName(`_${p}_${rest[p]}`)).join('');\n  }\n}","map":{"version":3,"mappings":"AAAA,SAAQA,QAAQ,EAAEC,QAAQ,QAAO,WAAW;AAC5C,SAAsBC,kBAAkB,QAAO,YAAY;AAC3D,SAAQC,mBAAmB,EAAEC,IAAI,EAAEC,SAAS,EAAEC,OAAO,QAAO,QAAQ;AAEpE;AACA,OAAO,MAAMC,2BAA2B,GAAG;EACzCC,IAAI,EAAE,CAAC;EACPC,OAAO,EAAE,CAAC;EACVC,KAAK,EAAE,CAAC;EACRC,IAAI,EAAE,CAAC;EACPC,GAAG,EAAE,CAAC;EACNC,SAAS,EAAE,CAAC;EACZC,IAAI,EAAE,CAAC;EACPC,KAAK,EAAE,CAAC;EACRC,OAAO,EAAE,CAAC;EACVC,OAAO,EAAE,CAAC;EACVC,YAAY,EAAE;CACN;AAIV,OAAO,MAAMC,cAAc,GAAGf,IAAI,CAACG,2BAA2B,CAAC;AAE/D,OAAM,SAAUa,qBAAqB,CAACC,QAAgB;EACpD,OAAO,CAAC,CAACd,2BAA2B,CAACc,QAAQ,CAAC;AAChD;AAEA,OAAO,MAAMC,yBAAyB,GAAG;EACvCC,OAAO,EAAE,CAAC;EACVC,UAAU,EAAE,CAAC;EACbC,QAAQ,EAAE,CAAC;EACXC,OAAO,EAAE,CAAC;EACVC,MAAM,EAAE,CAAC;EACTC,YAAY,EAAE,CAAC;EACfC,OAAO,EAAE,CAAC;EACVC,QAAQ,EAAE,CAAC;EACXC,UAAU,EAAE,CAAC;EACbC,UAAU,EAAE,CAAC;EACbC,eAAe,EAAE;CACT;AAMV,OAAO,MAAMC,0BAA0B,GAAG;EACxCC,WAAW,EAAE,CAAC;EACdC,gBAAgB,EAAE,CAAC;EAEnBC,SAAS,EAAE,CAAC;EACZC,aAAa,EAAE,CAAC;EAChBC,kBAAkB,EAAE,CAAC;EACrBC,yBAAyB,EAAE,CAAC;EAC5BC,gCAAgC,EAAE,CAAC;EAEnCC,QAAQ,EAAE,CAAC;EACXC,WAAW,EAAE,CAAC;EACdC,gBAAgB,EAAE,CAAC;EACnBC,uBAAuB,EAAE,CAAC;EAC1BC,8BAA8B,EAAE,CAAC;EAEjCC,aAAa,EAAE,CAAC;EAEhBC,YAAY,EAAE,CAAC;EAEfC,SAAS,EAAE,CAAC;EACZC,cAAc,EAAE,CAAC;EACjBC,qBAAqB,EAAE,CAAC;EACxBC,4BAA4B,EAAE,CAAC;EAE/BC,OAAO,EAAE,CAAC;EACVC,aAAa,EAAE,CAAC;EAChBC,mBAAmB,EAAE,CAAC;EACtBC,0BAA0B,EAAE,CAAC;EAE7BC,QAAQ,EAAE,CAAC;EACXC,eAAe,EAAE,CAAC;EAClBC,sBAAsB,EAAE,CAAC;EAEzBC,YAAY,EAAE,CAAC;EACfC,mBAAmB,EAAE,CAAC;EAEtBC,cAAc,EAAE,CAAC;EAEjBC,mBAAmB,EAAE;CACb;AAIV,OAAO,MAAMC,wBAAwB,GAAG;EACtCC,cAAc,EAAE,CAAC;EACjBC,mBAAmB,EAAE,CAAC;EAEtBC,YAAY,EAAE,CAAC;EACfC,gBAAgB,EAAE,CAAC;EACnBC,qBAAqB,EAAE,CAAC;EACxBC,4BAA4B,EAAE,CAAC;EAC/BC,mCAAmC,EAAE,CAAC;EAEtCC,WAAW,EAAE,CAAC;EACdC,cAAc,EAAE,CAAC;EACjBC,mBAAmB,EAAE,CAAC;EACtBC,0BAA0B,EAAE,CAAC;EAC7BC,iCAAiC,EAAE,CAAC;EAEpCC,gBAAgB,EAAE,CAAC;EAEnBC,eAAe,EAAE,CAAC;EAElBC,YAAY,EAAE,CAAC;EACfC,iBAAiB,EAAE,CAAC;EACpBC,wBAAwB,EAAE,CAAC;EAC3BC,+BAA+B,EAAE,CAAC;EAElCC,UAAU,EAAE,CAAC;EACbC,gBAAgB,EAAE,CAAC;EACnBC,sBAAsB,EAAE,CAAC;EACzBC,6BAA6B,EAAE,CAAC;EAEhCC,WAAW,EAAE,CAAC;EACdC,kBAAkB,EAAE,CAAC;EACrBC,yBAAyB,EAAE,CAAC;EAE5BC,eAAe,EAAE,CAAC;EAClBC,sBAAsB,EAAE,CAAC;EAEzBC,iBAAiB,EAAE,CAAC;EAEpBC,sBAAsB,EAAE;CAChB;AASV,OAAM,SAAUC,aAAa,CAACC,CAAS;EACrC,OAAOA,CAAC,CAACC,UAAU,CAAC,KAAK,CAAC;AAC5B;AAEA,OAAM,SAAUC,gBAAgB,CAACF,CAAc;EAC7C,OAAOA,CAAC,CAACG,MAAM,CAAC,CAAC,CAAkB;AACrC;AA6CA;AACA,OAAO,MAAMC,mBAAmB,GAAqB;EACnD,YAAY,EAAE,QAAQ;EACtB,iBAAiB,EAAE;CACpB;AAED,OAAM,SAAUC,gBAAgB,CAAC/E,QAAkB;EACjD,OAAOF,cAAc,CAACkF,MAAM,CAACC,IAAI,IAAIC,gBAAgB,CAAClF,QAAQ,EAAEiF,IAAI,CAAC,CAAC;AACxE;AAEA,OAAM,SAAUE,uBAAuB,CAACnF,QAAkB;EACxD,MAAMoF,KAAK,GAAGL,gBAAgB,CAAC/E,QAAQ,CAAC;EACxC,OAAOoF,KAAK,CAACA,KAAK,CAACC,MAAM,GAAG,CAAC,CAAC;AAChC;AAEA;AACA,OAAM,SAAUH,gBAAgB,CAACI,YAAsB,EAAEtF,QAAkB;EACzE,MAAMuF,KAAK,GAAGD,YAAY,CAACE,OAAO,CAACxF,QAAQ,CAAC;EAE5C,IAAIuF,KAAK,GAAG,CAAC,EAAE;IACb,OAAO,KAAK;;EAGd;EACA,IAAIA,KAAK,GAAG,CAAC,IAAIvF,QAAQ,KAAK,SAAS,IAAIsF,YAAY,CAACG,MAAM,CAACF,KAAK,GAAG,CAAC,CAAC,KAAK,GAAG,EAAE;IACjF,OAAO,KAAK;;EAGd;EACA,IAAID,YAAY,CAACD,MAAM,GAAGE,KAAK,GAAG,CAAC,IAAIvF,QAAQ,KAAK,KAAK,IAAIsF,YAAY,CAACG,MAAM,CAACF,KAAK,GAAG,CAAC,CAAC,KAAK,GAAG,EAAE;IACnG,OAAO,KAAK;;EAEd,IAAIA,KAAK,GAAG,CAAC,IAAIvF,QAAQ,KAAK,MAAM,IAAIsF,YAAY,CAACG,MAAM,CAACF,KAAK,GAAG,CAAC,CAAC,KAAK,GAAG,EAAE;IAC9E,OAAO,KAAK;;EAGd,OAAO,IAAI;AACb;AAEA;;;AAGA,OAAM,SAAUG,SAAS,CAACJ,YAAsB,EAAEK,KAAa,EAAE;EAACC;AAAG,IAAoB;EAACA,GAAG,EAAE;AAAK,CAAC;EACnG,MAAMC,QAAQ,GAAG/G,mBAAmB,CAAC6G,KAAK,CAAC;EAE3C,MAAMG,GAAG,GAAGrB,aAAa,CAACa,YAAY,CAAC,GAAG,KAAK,GAAG,EAAE;EAEpD,SAASS,IAAI,CAAC/F,QAAkB;IAC9B,IAAIA,QAAQ,KAAK,SAAS,EAAE;MAC1B;MACA,OAAO,IAAI8F,GAAG,WAAWD,QAAQ,MAAM;KACxC,MAAM;MACL,OAAO,GAAGC,GAAG,GAAG9F,QAAQ,IAAI6F,QAAQ,GAAG;;EAE3C;EAEA,IAAIG,YAAsB;EAE1B,MAAMC,QAAQ,GAAiB,EAAE;EAEjC,KAAK,MAAMhB,IAAI,IAAInF,cAAc,EAAE;IACjC,IAAIoF,gBAAgB,CAACI,YAAY,EAAEL,IAAI,CAAC,EAAE;MACxCgB,QAAQ,CAAChB,IAAI,CAAC,GAAGc,IAAI,CAACd,IAAI,CAAC;MAC3Be,YAAY,GAAGf,IAAI;;;EAIvB,IAAIW,GAAG,EAAE;IACPK,QAAQ,CAACD,YAAY,CAAC,IAAI,IAAI;;EAGhC,OAAOnH,kBAAkB,CAACoH,QAAQ,CAAC;AACrC;AAEA,OAAM,SAAUC,2BAA2B,CAAClG,QAAkB;EAC5D,IAAI,CAACA,QAAQ,EAAE;IACb,OAAOmG,SAAS;;EAGlB,MAAMC,aAAa,GAAGrB,gBAAgB,CAAC/E,QAAQ,CAAC;EAChD,OAAO,qBAAqBhB,SAAS,CAACoH,aAAa,CAAC,KAAKpH,SAAS,CAAC8F,mBAAmB,CAAC,GAAG;AAC5F;AAEA;;;AAGA,OAAM,SAAUuB,gBAAgB,CAACrG,QAAkB,EAAE2F,KAAa,EAAEW,UAAmB;EACrF,IAAI,CAACtG,QAAQ,EAAE;IACb,OAAOmG,SAAS;;EAGlB,MAAMI,IAAI,GAAGL,2BAA2B,CAAClG,QAAQ,CAAC;EAElD;EACA;EACA;EACA,MAAM8F,GAAG,GAAGQ,UAAU,IAAI7B,aAAa,CAACzE,QAAQ,CAAC;EAEjD,OAAO,GAAG8F,GAAG,GAAG,KAAK,GAAG,MAAM,UAAUH,KAAK,KAAKY,IAAI,GAAG;AAC3D;AAEA,OAAM,SAAUC,iBAAiB,CAACxG,QAAmC;EACnE,IAAI,CAACA,QAAQ,EAAE;IACb,OAAOmG,SAAS;;EAGlB,IAAIM,MAAsB;EAC1B,IAAI7H,QAAQ,CAACoB,QAAQ,CAAC,EAAE;IACtByG,MAAM,GAAG;MACPC,IAAI,EAAE1G;KACP;GACF,MAAM,IAAIrB,QAAQ,CAACqB,QAAQ,CAAC,EAAE;IAC7ByG,MAAM,GAAG;MACP,GAAGzG,QAAQ;MACX,IAAIA,QAAQ,CAAC0G,IAAI,GAAG;QAACA,IAAI,EAAE1G,QAAQ,CAAC0G;MAAI,CAAC,GAAG,EAAE;KAC/C;;EAGH,IAAIjC,aAAa,CAACgC,MAAM,CAACC,IAAI,CAAC,EAAE;IAC9BD,MAAM,CAACX,GAAG,GAAG,IAAI;IACjBW,MAAM,CAACC,IAAI,GAAG9B,gBAAgB,CAAC6B,MAAM,CAACC,IAAI,CAAC;;EAG7C,OAAOD,MAAM;AACf;AAEA,OAAM,SAAUE,gBAAgB,CAACC,EAA6B;EAC5D,MAAM;IAACd,GAAG;IAAE,GAAGe;EAAI,CAAC,GAAGL,iBAAiB,CAACI,EAAE,CAAC;EAE5C,IAAIC,IAAI,CAACH,IAAI,EAAE;IACb,OACE,CAACZ,GAAG,GAAG,KAAK,GAAG,EAAE,IACjB/G,IAAI,CAAC8H,IAAI,CAAC,CACPC,GAAG,CAACC,CAAC,IAAI9H,OAAO,CAAC,GAAG8H,CAAC,KAAK,MAAM,GAAG,EAAE,GAAG,IAAIA,CAAC,GAAG,GAAGF,IAAI,CAACE,CAAC,CAAC,EAAE,CAAC,CAAC,CAC9DC,IAAI,CAAC,EAAE,CAAC;GAEd,MAAM;IACL;IACA,OACE,CAAClB,GAAG,GAAG,KAAK,GAAG,EAAE,IACjB,UAAU,GACV/G,IAAI,CAAC8H,IAAI,CAAC,CACPC,GAAG,CAACC,CAAC,IAAI9H,OAAO,CAAC,IAAI8H,CAAC,IAAIF,IAAI,CAACE,CAAC,CAAC,EAAE,CAAC,CAAC,CACrCC,IAAI,CAAC,EAAE,CAAC;;AAGjB","names":["isObject","isString","dateTimeExprToExpr","accessPathWithDatum","keys","stringify","varName","LOCAL_SINGLE_TIMEUNIT_INDEX","year","quarter","month","week","day","dayofyear","date","hours","minutes","seconds","milliseconds","TIMEUNIT_PARTS","isLocalSingleTimeUnit","timeUnit","UTC_SINGLE_TIMEUNIT_INDEX","utcyear","utcquarter","utcmonth","utcweek","utcday","utcdayofyear","utcdate","utchours","utcminutes","utcseconds","utcmilliseconds","LOCAL_MULTI_TIMEUNIT_INDEX","yearquarter","yearquartermonth","yearmonth","yearmonthdate","yearmonthdatehours","yearmonthdatehoursminutes","yearmonthdatehoursminutesseconds","yearweek","yearweekday","yearweekdayhours","yearweekdayhoursminutes","yearweekdayhoursminutesseconds","yeardayofyear","quartermonth","monthdate","monthdatehours","monthdatehoursminutes","monthdatehoursminutesseconds","weekday","weeksdayhours","weekdayhoursminutes","weekdayhoursminutesseconds","dayhours","dayhoursminutes","dayhoursminutesseconds","hoursminutes","hoursminutesseconds","minutesseconds","secondsmilliseconds","UTC_MULTI_TIMEUNIT_INDEX","utcyearquarter","utcyearquartermonth","utcyearmonth","utcyearmonthdate","utcyearmonthdatehours","utcyearmonthdatehoursminutes","utcyearmonthdatehoursminutesseconds","utcyearweek","utcyearweekday","utcyearweekdayhours","utcyearweekdayhoursminutes","utcyearweekdayhoursminutesseconds","utcyeardayofyear","utcquartermonth","utcmonthdate","utcmonthdatehours","utcmonthdatehoursminutes","utcmonthdatehoursminutesseconds","utcweekday","utcweeksdayhours","utcweekdayhoursminutes","utcweekdayhoursminutesseconds","utcdayhours","utcdayhoursminutes","utcdayhoursminutesseconds","utchoursminutes","utchoursminutesseconds","utcminutesseconds","utcsecondsmilliseconds","isUTCTimeUnit","t","startsWith","getLocalTimeUnit","substr","VEGALITE_TIMEFORMAT","getTimeUnitParts","filter","part","containsTimeUnit","getSmallestTimeUnitPart","parts","length","fullTimeUnit","index","indexOf","charAt","fieldExpr","field","end","fieldRef","utc","func","lastTimeUnit","dateExpr","timeUnitSpecifierExpression","undefined","timeUnitParts","formatExpression","isUTCScale","expr","normalizeTimeUnit","params","unit","timeUnitToString","tu","rest","map","p","join"],"sourceRoot":"","sources":["../../src/timeunit.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}